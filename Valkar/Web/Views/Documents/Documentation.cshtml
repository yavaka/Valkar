@using Infrastructure.Common.Global
@model ApplicationCore.ServiceModels.Document.DocumentationGridServiceModel

@{
    ViewData["Title"] = "Documentation";
}

<div class="container" data-layout="container">
    <partial name="_NavbarPartial" />
    <div class="content" style="margin-top: 1%">
        <div class="card mb-3" style="padding-left: 1%; padding-right: 1%;">

            @*-- Documentation header --*@
            <div class="card-header border-bottom">
                <div class="row align-items-center">
                    <div class="col">
                        <h4 class="mb-0">Documents</h4>
                    </div>
                    <div class="col-auto">
                        @if (User.IsInRole(Role.Admin))
                        {
                            <a class="btn btn-falcon-default btn-sm" type="button" asp-controller="Documents" asp-action="SendDocument"><span class="fas fa-paper-plane" data-fa-transform="shrink-3 down-2"></span><span class="d-none d-sm-inline-block ms-1">Send Document</span></a>
                        }
                        <button class="btn btn-falcon-default btn-sm @(User.IsInRole(Role.Admin) ? "mx-2" : "")" type="button" data-bs-toggle="modal" data-bs-target="#documents-filter"><span class="fas fa-filter" data-fa-transform="shrink-3 down-2"></span><span class="d-none d-sm-inline-block ms-1">Filter</span></button>
                    </div>
                </div>
            </div>

            @*-- Document Cards --*@
            <div class="card-body">
                <div class="row">
                    @foreach (var doc in Model.Documents)
                    {
                        <div class="col-sm-12 col-md-6 col-lg-4 col-xl-3 document-card" data-doc-name="@doc.Name" data-doc-signed="@doc.IsSigned.ToString().ToLower()" data-doc-employee="@(doc.SentTo != null ? $"{doc.SentTo.FirstNames} {doc.SentTo.Surname}" : "")">
                            <div class="card mb-3" style="padding-left: 1%; padding-right: 1%;">
                                <div class="card-body">
                                    @if (doc.IsSigned)
                                    {
                                        <h5 class="card-title"><span class="fas fa-check-circle text-success"></span> @doc.Name</h5>
                                    }
                                    else
                                    {
                                        <h5 class="card-title">@doc.Name</h5>
                                    }
                                    <hr />
                                    <p class="card-text">@doc.MessageToEmployee</p>
                                    <p>@doc.SentTo.FirstNames @doc.SentTo.Surname</p>
                                    <p>@doc.UploadedOn</p>
                                    <hr />
                                    @*-- preview btn --*@
                                    <a class="btn btn-primary btn-sm" onclick="Documents.onPreviewClick('@doc.Id')"><span class="fas fa-eye" data-fa-transform="shrink-3 down-2"></span><span class="d-none d-sm-inline-block ms-1">Preview</span></a>
                                    @if (User.IsInRole(Role.Admin))
                                    {
                                        @*-- delete btn --*@
                                        <a class="btn btn-danger btn-sm" onclick="Documents.deleteConfirmation('@doc.Id')" style='cursor: pointer'><span class="fas fa-trash" data-fa-transform="shrink-3 down-2"></span><span class="d-none d-sm-inline-block ms-1">Delete</span></a>
                                    }
                                    else if (!doc.IsSigned)
                                    {
                                        @*-- upload btn: only when driver has not yet uploaded the signed document --*@
                                        <a class="btn btn-secondary btn-sm" asp-action="UploadSignedDocument" asp-route-docId="@doc.Id" style='cursor: pointer'><span class="fas fa-upload" data-fa-transform="shrink-3 down-2"></span><span class="d-none d-sm-inline-block ms-1">Upload</span></a>
                                    }
                                </div>
                            </div>
                        </div>
                    }
                </div>
                @if (Model.Documents.Count is 0)
                {
                    <div class="row">
                        <h6 class="text-center">No records</h6>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

<div id="deleteConfirmationDialog"></div>

@* Documents filter modal - must exist for Filter button to work *@
<div class="modal fade" id="documents-filter" tabindex="-1" aria-labelledby="documents-filter-label" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="documents-filter-label">Filter documents</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label" for="filter-signed">Status</label>
                    <select class="form-select" id="filter-signed">
                        <option value="">All</option>
                        <option value="signed">Signed only</option>
                        <option value="unsigned">Unsigned only</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label" for="filter-search">Search (document or employee name)</label>
                    <input type="text" class="form-control" id="filter-search" placeholder="Type to filter..." />
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="documents-filter-apply">Apply</button>
                <button type="button" class="btn btn-falcon-default" id="documents-filter-clear">Clear</button>
            </div>
        </div>
    </div>
</div>

@section Scripts{

    <script src="@Url.Content("~/js/Views/Documents/Documents.js")"></script>

    <script>
        $(document).ready(function () {
            Documents.onInit({
                deleteConfirmationUrl: '@Url.Action("ConfirmDeletion", "Documents")'
            });
            Documents.initFilter();
        });
    </script>
}